# =============================================================================
# 游 CONEX츾O DE SORTE - TRAEFIK v3.5.2 MODERNA E ESCAL츼VEL
# =============================================================================
# Configura칞칚o principal otimizada para:
# - Seguran칞a avan칞ada (OWASP compliance)
# - Escalabilidade para futuras APIs REST
# - Performance otimizada
# - Facilidade de manuten칞칚o e expans칚o
# =============================================================================

---
global:
  checkNewVersion: false
  sendAnonymousUsage: false

# =============================================================================
# 游늵 API E DASHBOARD - SEGURO E MONITOR츼VEL
# =============================================================================
api:
  dashboard: true
  insecure: false
  debug: false
  # Habilitado para m칠tricas e health checks internos

# =============================================================================
# 游깷 ENTRY POINTS - HTTP/HTTPS/HTTP3 OTIMIZADOS
# =============================================================================
entryPoints:
  # HTTP Entry Point - Apenas para redirecionamentos e ACME challenge
  web:
    address: ":80"
    # Rate limiting no entry point para DDoS protection
    transport:
      respondingTimeouts:
        readTimeout: "10s"
        writeTimeout: "10s"
        idleTimeout: "120s"

  # HTTPS Entry Point - Produ칞칚o com HTTP/3
  websecure:
    address: ":443"
    # HTTP/3 (QUIC) para performance moderna
    http3:
      advertisedPort: 443
    transport:
      respondingTimeouts:
        readTimeout: "30s"
        writeTimeout: "30s"
        idleTimeout: "300s"
    # Configura칞칚o avan칞ada de TLS
    tls:
      options: modern-tls@file
    # Rate limiting por IP
    middlewares:
      - "rate-limit-global@file"

  # Dashboard interno - Apenas interno
  traefik-internal:
    address: ":8080"
    transport:
      respondingTimeouts:
        readTimeout: "5s"
        writeTimeout: "5s"
        idleTimeout: "60s"

# =============================================================================
# 游니 PROVIDERS - DOCKER SWARM + ARQUIVOS DIN츽MICOS
# =============================================================================
providers:
  # Docker Swarm Provider - Detec칞칚o autom치tica
  docker:
    endpoint: "unix:///var/run/docker.sock"
    exposedByDefault: false
    watch: true
    network: conexao-network-swarm
    swarmMode: true  # Expl칤cito para Docker Swarm
    useBindPortIP: false
    # Polling interval otimizado
    pollInterval: "5s"
    # Constraints para filtrar servi칞os
    constraints: "Label(`traefik.enable`, `true`)"

  # File Provider - Configura칞칚o din칙mica
  file:
    directory: "/etc/traefik/dynamic"
    watch: true
    # Intervalo de verifica칞칚o otimizado
    pollInterval: "2s"

# =============================================================================
# 游닇 LOGGING - ESTRUTURADO E SEGURO
# =============================================================================
log:
  level: INFO
  format: json
  filePath: "/dev/stdout"  # Container-friendly logging

# Access logs desabilitados para evitar vazamento de dados
# Podem ser habilitados em desenvolvimento se necess치rio
# accessLog:
#   format: json
#   bufferingSize: 0
#   filters:
#     statusCodes:
#       - "400-499"
#       - "500-599"

# =============================================================================
# 游댏 CERTIFICADOS SSL - LET'S ENCRYPT OTIMIZADO
# =============================================================================
certificatesResolvers:
  letsencrypt:
    acme:
      email: "facilitaservicos.tec@gmail.com"
      storage: /letsencrypt/acme.json
      # Usar HTTP challenge (mais est치vel que DNS)
      httpChallenge:
        entryPoint: web
      # Rate limiting interno do ACME
      caServer: "https://acme-v02.api.letsencrypt.org/directory"

  # Resolver de staging para testes (comentado para produ칞칚o)
  # letsencrypt-staging:
  #   acme:
  #     email: "facilitaservicos.tec@gmail.com"
  #     storage: /letsencrypt/acme-staging.json
  #     caServer: "https://acme-staging-v02.api.letsencrypt.org/directory"
  #     httpChallenge:
  #       entryPoint: web

# =============================================================================
# 游늵 M칄TRICAS E MONITORAMENTO - PROMETHEUS + HEALTH CHECKS
# =============================================================================
ping:
  entryPoint: traefik-internal

metrics:
  prometheus:
    addEntryPointsLabels: true
    addServicesLabels: true
    addRoutersLabels: true
    # Buckets otimizados para web applications
    buckets:
      - 0.005
      - 0.01
      - 0.025
      - 0.05
      - 0.1
      - 0.25
      - 0.5
      - 1.0
      - 2.5
      - 5.0
      - 10.0

# =============================================================================
# 游 TRANSPORT CONFIGURATIONS - OTIMIZADO PARA PERFORMANCE
# =============================================================================
serversTransport:
  # SSL/TLS configuration para backend services
  insecureSkipVerify: false  # Manter seguran칞a
  rootCAs:
    - "/etc/ssl/certs/ca-certificates.crt"
  # Timeouts otimizados para APIs REST
  forwardingTimeouts:
    dialTimeout: "10s"
    responseHeaderTimeout: "30s"
    expectContinueTimeout: "1s"
    idleConnTimeout: "90s"
  # Connection pooling para performance
  maxIdleConnsPerHost: 10
  disableHTTP2: false  # Manter HTTP/2 habilitado

# =============================================================================
# 游댢 CONFIGURA칂칏ES EXPERIMENTAIS - TRAEFIK v3.5.2
# =============================================================================
experimental:
  # Plugins habilitados para extensibilidade futura
  plugins:
    enabled: true
  # HTTP/3 experimental features
  http3: true

# =============================================================================
# 游늳 CLUSTER CONFIGURATION - PREPARADO PARA SCALING
# =============================================================================
cluster:
  # Preparado para cluster multi-node (quando necess치rio)
  store: "consul"
  prefix: "/traefik"

# Configura칞칚o ser치 expandida quando usar Consul/etcd para HA