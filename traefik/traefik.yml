# =============================================================================
# 游 CONEX츾O DE SORTE - TRAEFIK v3.5.2 PRODU칂츾O EST츼VEL
# =============================================================================
# Configura칞칚o corrigida para Traefik v3.5.2 com:
# - Provider Docker Swarm correto (docker com swarmMode: true)
# - Entry points sem middlewares inline (movidos para dynamic)
# - TLS e HTTP/3 configurados corretamente
# - Compatibilidade total com v3.5.2
# =============================================================================

---
global:
  checkNewVersion: false
  sendAnonymousUsage: false

# =============================================================================
# 游늵 API E DASHBOARD - PRODU칂츾O SEGURA
# =============================================================================
api:
  dashboard: true
  insecure: false
  debug: false

# =============================================================================
# 游깷 ENTRY POINTS - SINTAXE CORRETA v3.5.3
# =============================================================================
entryPoints:
  # HTTP Entry Point - ACME challenges e redirects
  web:
    address: ":80"
    transport:
      respondingTimeouts:
        readTimeout: "10s"
        writeTimeout: "10s"
        idleTimeout: "120s"

  # HTTPS Entry Point - Produ칞칚o com HTTP/3
  websecure:
    address: ":443"
    transport:
      respondingTimeouts:
        readTimeout: "30s"
        writeTimeout: "30s"
        idleTimeout: "300s"
    # HTTP/3 configurado corretamente para v3.5.3
    http3:
      advertisedPort: 443

  # Dashboard interno
  traefik:
    address: ":8080"
    transport:
      respondingTimeouts:
        readTimeout: "5s"
        writeTimeout: "5s"
        idleTimeout: "60s"

# =============================================================================
# 游니 PROVIDERS - DOCKER SWARM CORRETO v3.5.3
# =============================================================================
providers:
  # Provider Docker com Swarm Mode (sintaxe correta v3.5.3)
  docker:
    endpoint: "unix:///var/run/docker.sock"
    exposedByDefault: false
    watch: true
    network: conexao-network-swarm
    swarmMode: true  # Modo Swarm ativado
    useBindPortIP: false
    constraints: "Label(`traefik.enable`, `true`)"

  # File Provider - Configura칞칚o din칙mica
  file:
    directory: "/etc/traefik/dynamic"
    watch: true

# =============================================================================
# 游닇 LOGGING - ESTRUTURADO E SEGURO
# =============================================================================
log:
  level: INFO
  format: json
  filePath: "/dev/stdout"  # Container-friendly logging

# Access logs desabilitados para evitar vazamento de dados
# Podem ser habilitados em desenvolvimento se necess치rio
# accessLog:
#   format: json
#   bufferingSize: 0
#   filters:
#     statusCodes:
#       - "400-499"
#       - "500-599"

# =============================================================================
# 游댏 CERTIFICADOS SSL - LET'S ENCRYPT OTIMIZADO
# =============================================================================
certificatesResolvers:
  letsencrypt:
    acme:
      email: "facilitaservicos.tec@gmail.com"
      storage: /letsencrypt/acme.json
      # Usar HTTP challenge (mais est치vel que DNS)
      httpChallenge:
        entryPoint: web
      # Rate limiting interno do ACME
      caServer: "https://acme-v02.api.letsencrypt.org/directory"

  # Resolver de staging para testes (comentado para produ칞칚o)
  # letsencrypt-staging:
  #   acme:
  #     email: "facilitaservicos.tec@gmail.com"
  #     storage: /letsencrypt/acme-staging.json
  #     caServer: "https://acme-staging-v02.api.letsencrypt.org/directory"
  #     httpChallenge:
  #       entryPoint: web

# =============================================================================
# 游늵 M칄TRICAS E MONITORAMENTO - PROMETHEUS v3.5.3
# =============================================================================
ping:
  entryPoint: traefik

metrics:
  prometheus:
    addEntryPointsLabels: true
    addServicesLabels: true
    addRoutersLabels: true
    # Buckets otimizados para produ칞칚o
    buckets:
      - 0.005
      - 0.01
      - 0.025
      - 0.05
      - 0.1
      - 0.25
      - 0.5
      - 1.0
      - 2.5
      - 5.0
      - 10.0

# =============================================================================
# 游 TRANSPORT CONFIGURATIONS - DESABILITADO AT칄 VALIDAR TRUSTSTORE DO CONTAINER
# =============================================================================
# serversTransport:
#   # SSL/TLS configuration para backend services
#   insecureSkipVerify: false  # Manter seguran칞a
#   rootCAs:
#     - "/etc/ssl/certs/ca-certificates.crt"
#   # Timeouts otimizados para APIs REST
#   forwardingTimeouts:
#     dialTimeout: "10s"
#     responseHeaderTimeout: "30s"
#     expectContinueTimeout: "1s"
#     idleConnTimeout: "90s"
#   # Connection pooling para performance
#   maxIdleConnsPerHost: 10
#   disableHTTP2: false  # Manter HTTP/2 habilitado

# =============================================================================
# 游댢 CONFIGURA칂칏ES EXPERIMENTAIS - DESABILITADAS AT칄 VALIDA칂츾O
# =============================================================================
# experimental:
#   http3: true

# =============================================================================
# 游늳 CLUSTER CONFIGURATION - PENDENTE DE CONSUL/ETCD
# =============================================================================
# cluster:
#   store: "consul"
#   prefix: "/traefik"

# Os blocos acima permanecem comentados at칠 que os backends necess치rios
# (Consul/etcd e valida칞칚o de plugins) estejam provisionados em produ칞칚o.
